{% extends "base.html" %}
{% block title %}Proyectos{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h4 m-0">Proyectos</h1>
  <div class="d-flex gap-2">
    {# Crear proyecto #}
    {% if can('project.create') %}
    <a class="btn btn-primary btn-sm" href="{{ url_for('proyectos.nuevo') }}">
      Nuevo
    </a>
    {% endif %}

    {# Asignar alumno a proyecto #}
    {% if can('project.assign') %}
    <a class="btn btn-outline-light btn-sm" href="{{ url_for('proyectos.asignar_alumno') }}">
      Asignar alumnos
    </a>
    {% endif %}

    {# Asignar jefe/laboratorista a proyecto #}
    {% if can('project.assign_staff') %}
    <a class="btn btn-outline-light btn-sm" href="{{ url_for('proyectos.asignar_staff') }}">
      Asignar responsable
    </a>
    {% endif %}

    {# Capturar reportes bimestrales (1/2/3) #}
    {% if can('report.capture') %}
    <a class="btn btn-success btn-sm" href="{{ url_for('proyectos.reportes_selector') }}">
      Capturar reportes
    </a>
    {% endif %}
  </div>
</div>

<div class="table-responsive">
  <table class="table table-dark table-striped align-middle">
    <thead>
      <tr>
        <th>ID</th>
        <th>Programa</th>
        <th>Dependencia</th>
        <th>Responsable</th>
        <th>Cargo</th>
        <th>Municipio</th>
        <th>Estado</th>
        <th class="text-end">Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
      <tr>
        <td>{{ r.id }}</td>
        <td>{{ r.programa }}</td>
        <td>{{ r.dependencia }}</td>
        <td>{{ r.responsable }}</td>
        <td>{{ r.cargo }}</td>
        <td>{{ r.municipio }}</td>
        <td>{{ r.estado }}</td>
        <td class="text-end">
          <a class="btn btn-sm btn-outline-light" href="{{ url_for('proyectos.detalle', id=r.id) }}">
            Detalle
          </a>

          {# Editar solo si el rol puede #}
          {% if can('project.update') or can('project.edit') %}
          <a class="btn btn-sm btn-outline-warning" href="{{ url_for('proyectos.editar', id=r.id) }}">
            Editar
          </a>
          {% endif %}

          {# Eliminar solo si el rol puede #}
          {% if can('project.delete') %}
          <form method="post" action="{{ url_for('proyectos.eliminar', id=r.id) }}" class="d-inline"
            onsubmit="return confirm('Â¿Eliminar proyecto?')">
            {{ csrf_token() }}
            <button class="btn btn-sm btn-outline-danger">Eliminar</button>
          </form>
          {% endif %}
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="8" class="text-center">No hay proyectos.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}