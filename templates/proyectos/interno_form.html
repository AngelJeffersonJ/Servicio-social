{% extends "base.html" %}
{% block title %}Formato interno del proyecto{% endblock %}
{% block content %}

<h4 class="mb-3">Formato interno del proyecto</h4>

<div class="card bg-dark border-secondary mb-3">
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-6">
                <div><small class="text-secondary">Proyecto</small>
                    <div>{{ proyecto.nombre or proyecto.nombre_programa }}</div>
                </div>
                <div class="mt-2"><small class="text-secondary">Dependencia</small>
                    <div>{{ proyecto.nombre_dependencia or (proyecto.departamento.nombre if proyecto.departamento else
                        '-') }}</div>
                </div>
            </div>
            <div class="col-md-6">
                <div><small class="text-secondary">Responsable</small>
                    <div>{{ proyecto.nombre_responsable or (proyecto.responsable_user.nombre if
                        proyecto.responsable_user else '-') }}</div>
                </div>
            </div>
        </div>
    </div>
</div>

<form method="post">
    {{ csrf_token() }}
    {% set fd = form_data|default({}) %}

    {% macro val(name, dflt='') -%}
    {{ fd.get(name, dflt) }}
    {%- endmacro %}

    {% macro is_on(v) -%}
    {{ 'checked' if v in ['on','X','x',1,'1',true,'true','True'] else '' }}
    {%- endmacro %}

    <div class="row g-3">
        <div class="col-md-6">
            <label class="form-label">Nombre del responsable ({{'NOMBRE_RESPONSABLE'}})</label>
            <input name="NOMBRE_RESPONSABLE" class="form-control" value="{{ val('NOMBRE_RESPONSABLE') }}">
        </div>
        <div class="col-md-6">
            <label class="form-label">Cargo del responsable ({{'CARGO_RESPONSABLE'}})</label>
            <input name="CARGO_RESPONSABLE" class="form-control" value="{{ val('CARGO_RESPONSABLE') }}">
        </div>
        <div class="col-md-6">
            <label class="form-label">Departamento/Área ({{'AREA_RESPONSABLE'}})</label>
            <input name="AREA_RESPONSABLE" class="form-control" value="{{ val('AREA_RESPONSABLE') }}">
        </div>
        <div class="col-md-3">
            <label class="form-label">Teléfono ({{'TELEFONO_RESPONSABLE'}})</label>
            <input name="TELEFONO_RESPONSABLE" class="form-control" value="{{ val('TELEFONO_RESPONSABLE') }}">
        </div>
        <div class="col-md-3">
            <label class="form-label">Correo ({{'CORREO_RESPONSABLE'}})</label>
            <input name="CORREO_RESPONSABLE" class="form-control" value="{{ val('CORREO_RESPONSABLE') }}">
        </div>
        <div class="col-md-12">
            <label class="form-label">Horario de visita ({{'HORARIO_RESPONSABLE'}})</label>
            <input name="HORARIO_RESPONSABLE" class="form-control" value="{{ val('HORARIO_RESPONSABLE') }}">
        </div>

        <!-- NUEVO: Periodo en el que se realizará -->
        <div class="col-md-12">
            <label class="form-label">Periodo en el que se realizará ({{'Periodo'}})</label>
            <input name="Periodo" class="form-control" value="{{ val('Periodo') }}">
        </div>
    </div>

    <hr class="my-4">

    <div class="row g-3">
        <div class="col-md-4">
            <label class="form-label">N° personas beneficiadas ({{'numero_personas'}})</label>
            <input name="numero_personas" class="form-control" value="{{ val('numero_personas') }}">
        </div>
        <div class="col-md-4">
            <label class="form-label">N° comunidades ({{'num_comunidades'}})</label>
            <input name="num_comunidades" class="form-control" value="{{ val('num_comunidades') }}">
        </div>
        <div class="col-md-4">
            <label class="form-label">N° estudiantes ({{'num_estudiantes'}})</label>
            <input name="num_estudiantes" class="form-control" value="{{ val('num_estudiantes') }}">
        </div>
    </div>

    <div class="mt-3">
        <label class="form-label d-block">Impactos</label>
        <div class="d-flex flex-wrap gap-4">
            <label class="form-check">
                <input type="checkbox" class="form-check-input" name="opcion1" {{ is_on(val('opcion1')) }}> Problemas
                prioritarios ({{'opcion1'}})
            </label>
            <label class="form-check">
                <input type="checkbox" class="form-check-input" name="opcion2" {{ is_on(val('opcion2')) }}> Inclusión e
                igualdad ({{'opcion2'}})
            </label>
            <label class="form-check">
                <input type="checkbox" class="form-check-input" name="opcion3" {{ is_on(val('opcion3')) }}> Medio
                ambiente ({{'opcion3'}})
            </label>
        </div>
    </div>

    <hr class="my-4">

    <div class="row g-3">
        <div class="col-md-12">
            <label class="form-label">Objetivo del proyecto ({{'objetivos_proyecto'}})</label>
            <textarea name="objetivos_proyecto" class="form-control" rows="3">{{ val('objetivos_proyecto') }}</textarea>
        </div>
        <div class="col-md-12">
            <label class="form-label">Metas ({{'metas_proyecto'}})</label>
            <textarea name="metas_proyecto" class="form-control" rows="3">{{ val('metas_proyecto') }}</textarea>
        </div>
    </div>

    <div class="mt-3">
        <label class="form-label d-block">Área del conocimiento</label>
        <div class="d-flex flex-wrap gap-4">
            {% for i,label in [
            (1,'Ciencia Agropecuarias'),(2,'Ciencias de la Salud'),(3,'Ciencias Naturales y Exactas'),
            (4,'Ciencias Sociales y Administrativas'),(5,'Educación y Humanidades'),(6,'Ingeniería y Técnica')
            ] %}
            <label class="form-check">
                <input type="checkbox" class="form-check-input" name="area{{i}}" {{ is_on(val('area' ~ i)) }}> {{label}}
                ({{'area' ~ i}})
            </label>
            {% endfor %}
        </div>
    </div>

    <div class="mt-3">
        <label class="form-label d-block">Turno</label>
        <div class="d-flex flex-wrap gap-4">
            <label class="form-check">
                <input type="checkbox" class="form-check-input" name="turno1" {{ is_on(val('turno1')) }}> Matutino
                ({{'turno1'}})
            </label>
            <label class="form-check">
                <input type="checkbox" class="form-check-input" name="turno2" {{ is_on(val('turno2')) }}> Vespertino
                ({{'turno2'}})
            </label>
        </div>
    </div>

    <div class="mt-4">
        <label class="form-label">Carrera solicitada</label>
        <div class="row">
            <div class="col-md-12 small text-secondary mb-2">* Ojo: la plantilla usa <strong>carrerera1</strong> (doble
                “re”) para TIC.</div>
            <div class="col-md-12 d-flex flex-wrap gap-4">
                <label class="form-check"><input type="checkbox" class="form-check-input" name="carrerera1" {{
                        is_on(val('carrerera1')) }}> Ing. TIC ({{'carrerera1'}})</label>
                <label class="form-check"><input type="checkbox" class="form-check-input" name="carrera2" {{
                        is_on(val('carrera2')) }}> Lic. Administración ({{'carrera2'}})</label>
                <label class="form-check"><input type="checkbox" class="form-check-input" name="carrera3" {{
                        is_on(val('carrera3')) }}> Ing. Química ({{'carrera3'}})</label>
                <label class="form-check"><input type="checkbox" class="form-check-input" name="carrera4" {{
                        is_on(val('carrera4')) }}> Ing. Industrial ({{'carrera4'}})</label>
                <label class="form-check"><input type="checkbox" class="form-check-input" name="carrera5" {{
                        is_on(val('carrera5')) }}> Ing. Mecánica ({{'carrera5'}})</label>
                <label class="form-check"><input type="checkbox" class="form-check-input" name="carrera6" {{
                        is_on(val('carrera6')) }}> Ing. Eléctrica ({{'carrera6'}})</label>
                <label class="form-check"><input type="checkbox" class="form-check-input" name="carrera7" {{
                        is_on(val('carrera7')) }}> Ing. Electrónica ({{'carrera7'}})</label>
                <label class="form-check"><input type="checkbox" class="form-check-input" name="carrera8" {{
                        is_on(val('carrera8')) }}> Ing. Gestión ({{'carrera8'}})</label>
                <label class="form-check"><input type="checkbox" class="form-check-input" name="carrera9" {{
                        is_on(val('carrera9')) }}> Ing. Materiales ({{'carrera9'}})</label>
            </div>
        </div>
    </div>

    <hr class="my-4">

    <h6 class="mb-2">Cronograma (marcar meses con “X” según la plantilla)</h6>
    <div class="table-responsive">
        <table class="table table-dark table-sm align-middle">
            <thead>
                <tr>
                    <th style="min-width:220px;">Actividad</th>
                    {% for mes in
                    ['enero','febrero','marzo','abril','mayo','junio','julio','agosto','septiembre','octubre','noviembre','diciembre']
                    %}
                    <th class="text-center text-capitalize">{{ mes }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for i in [1,2,3,4,5] %}
                <tr>
                    <td>
                        <input class="form-control form-control-sm" name="actividad{{i}}"
                            value="{{ val('actividad' ~ i) }}">
                    </td>
                    {% for mes in
                    ['enero','febrero','marzo','abril','mayo','junio','julio','agosto','septiembre','octubre','noviembre','diciembre']
                    %}
                    {% set key = mes ~ i %}
                    <td class="text-center">
                        <input type="checkbox" class="form-check-input" name="{{ key }}" {{ is_on(val(key)) }}>
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="d-flex gap-2 mt-3">
        <a href="{{ volver_url or url_for('proyectos.lista') }}" class="btn btn-outline-light">Volver</a>
        <button class="btn btn-primary">{{ 'Guardar cambios' if form_data else 'Guardar' }}</button>
    </div>
</form>

{% endblock %}